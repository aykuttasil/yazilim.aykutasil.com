<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Android ile WebView Etkileşimi - Software</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Aykut Asil" />
  <meta name="description" content="Kısa Hikaye : Üstünde çalışmakta olduğum bir projede kredi kartı ile ödeme yapısı kurmam gerekti. Kısaca projenin yapısından bahsedecek olursak
 Backend : .Net Client : Android (Java) Ödeme altyapısı : İyzico  Client tarafında rest isteğiyle tüm işlemlerimizi backend tarafında yapıyoruz. Ödeme yapımızı da bu doğrultuda geliştirdik.
Problem : 3DS ile ödeme almaya çalıştığımızda malumunuz işin içerisine bankanın bize telefonumuza gelen şifreyi girmemiz için göndermiş olduğu web sayfası vs." />
<meta name="keywords" content="software, android, java, webview, addJavascriptInterface, WebViewClient, JavascriptInterface" />







<meta name="generator" content="Hugo 0.30.2" />


<link rel="canonical" href="http://yazilim.aykutasil.com/android-webview-etkilesimi/" />

<link rel="apple-touch-icon" sizes="180x180" href="http://yazilim.aykutasil.com/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://yazilim.aykutasil.com/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="http://yazilim.aykutasil.com/favicon-16x16.png">
<link rel="manifest" href="http://yazilim.aykutasil.com/manifest.json">
<link rel="mask-icon" href="http://yazilim.aykutasil.com/safari-pinned-tab.svg" color="#5bbad5">







<link href="http://yazilim.aykutasil.com/dist/even.min.css?v=3.1.1" rel="stylesheet">
<link href="http://yazilim.aykutasil.com/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="Android ile WebView Etkileşimi" />
<meta property="og:description" content="Kısa Hikaye : Üstünde çalışmakta olduğum bir projede kredi kartı ile ödeme yapısı kurmam gerekti. Kısaca projenin yapısından bahsedecek olursak
 Backend : .Net Client : Android (Java) Ödeme altyapısı : İyzico  Client tarafında rest isteğiyle tüm işlemlerimizi backend tarafında yapıyoruz. Ödeme yapımızı da bu doğrultuda geliştirdik.
Problem : 3DS ile ödeme almaya çalıştığımızda malumunuz işin içerisine bankanın bize telefonumuza gelen şifreyi girmemiz için göndermiş olduğu web sayfası vs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://yazilim.aykutasil.com/android-webview-etkilesimi/" />



<meta property="article:published_time" content="2017-01-11T19:59:08&#43;03:00"/>

<meta property="article:modified_time" content="2017-01-11T19:59:08&#43;03:00"/>











<meta itemprop="name" content="Android ile WebView Etkileşimi">
<meta itemprop="description" content="Kısa Hikaye : Üstünde çalışmakta olduğum bir projede kredi kartı ile ödeme yapısı kurmam gerekti. Kısaca projenin yapısından bahsedecek olursak
 Backend : .Net Client : Android (Java) Ödeme altyapısı : İyzico  Client tarafında rest isteğiyle tüm işlemlerimizi backend tarafında yapıyoruz. Ödeme yapımızı da bu doğrultuda geliştirdik.
Problem : 3DS ile ödeme almaya çalıştığımızda malumunuz işin içerisine bankanın bize telefonumuza gelen şifreyi girmemiz için göndermiş olduğu web sayfası vs.">


<meta itemprop="datePublished" content="2017-01-11T19:59:08&#43;03:00" />
<meta itemprop="dateModified" content="2017-01-11T19:59:08&#43;03:00" />
<meta itemprop="wordCount" content="502">



<meta itemprop="keywords" content="sofware,android,java,webview,addJavascriptInterface,WebViewClient,JavascriptInterface," />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Android ile WebView Etkileşimi"/>
<meta name="twitter:description" content="Kısa Hikaye : Üstünde çalışmakta olduğum bir projede kredi kartı ile ödeme yapısı kurmam gerekti. Kısaca projenin yapısından bahsedecek olursak
 Backend : .Net Client : Android (Java) Ödeme altyapısı : İyzico  Client tarafında rest isteğiyle tüm işlemlerimizi backend tarafında yapıyoruz. Ödeme yapımızı da bu doğrultuda geliştirdik.
Problem : 3DS ile ödeme almaya çalıştığımızda malumunuz işin içerisine bankanın bize telefonumuza gelen şifreyi girmemiz için göndermiş olduğu web sayfası vs."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="http://yazilim.aykutasil.com/" class="logo">Software</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="http://yazilim.aykutasil.com/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="http://yazilim.aykutasil.com/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="http://yazilim.aykutasil.com/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="http://yazilim.aykutasil.com/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="http://yazilim.aykutasil.com/" class="logo">Software</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="http://yazilim.aykutasil.com/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="http://yazilim.aykutasil.com/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="http://yazilim.aykutasil.com/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="http://yazilim.aykutasil.com/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Android ile WebView Etkileşimi</h1>

      <div class="post-meta">
        <span class="post-time"> 2017-01-11 </span>
        <div class="post-category">
            
              <a href="http://yazilim.aykutasil.com/categories/yazilim/"> yazilim </a>
            
              <a href="http://yazilim.aykutasil.com/categories/android/"> android </a>
            
              <a href="http://yazilim.aykutasil.com/categories/java/"> java </a>
            
          </div>
        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title"></h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#layout-xml">Layout.xml</a></li>
<li><a href="#activity-fragment">Activity – Fragment</a></li>
<li><a href="#mywebviewclient">MyWebViewClient</a></li>
<li><a href="#mywebviewjavascriptinterface">MyWebViewJavascriptInterface</a></li>
<li><a href="#custom-html-content">Custom Html Content</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<p>Kısa Hikaye : Üstünde çalışmakta olduğum bir projede kredi kartı ile ödeme yapısı kurmam gerekti. Kısaca projenin yapısından bahsedecek olursak</p>

<ul>
<li>Backend : .Net</li>
<li>Client : Android (Java)</li>
<li>Ödeme altyapısı : İyzico</li>
</ul>

<p>Client tarafında rest isteğiyle tüm işlemlerimizi backend tarafında yapıyoruz. Ödeme yapımızı da bu doğrultuda geliştirdik.</p>

<p>Problem : 3DS ile ödeme almaya çalıştığımızda malumunuz işin içerisine bankanın bize telefonumuza gelen şifreyi girmemiz için göndermiş olduğu web sayfası vs. giriyor. Bu durumda client ile web sayfası iletişimini de bir şekilde sağlamamız gerekiyor.</p>

<hr />

<p>Yukarıda ki hikayeyi anlatarak kafanızda bir problemi canlandırmaya çalıştım. Benzer bir çok durum ile karşı karşıya kalabilirsiniz.</p>

<p>Ulan ben webview de ki butonu vs nasıl android tarafında kontrol edicem ? gibi akılda deli sorular oluşabilir..</p>

<p>Tabiri caiz ise : PhoneGap tarzı bişiler.. 🙂 😉</p>

<p>Neyse.</p>

<p>Örnek ver hacı abi;</p>

<h2 id="layout-xml">Layout.xml</h2>

<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot;&gt;

    &lt;WebView
        android:id=&quot;@+id/WebView&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot; /&gt;

&lt;/LinearLayout&gt;
</code></pre>

<h2 id="activity-fragment">Activity – Fragment</h2>

<pre><code class="language-java">WebView webView = (WebView) findViewById(R.id.WebView);

WebSettings settings = webView.getSettings();
settings.setDefaultTextEncodingName(&quot;utf-8&quot;);
settings.setJavaScriptEnabled(true);

webView.setWebViewClient(new MyWebViewClient());
webView.addJavascriptInterface(new MyWebViewJavascriptInterface(mContext, webView, callbackDialog), &quot;Android&quot;); // Buraya dikkat
webView.loadDataWithBaseURL(null, response.getData().getThreeDSHtmlContent(), &quot;text/html&quot;, &quot;utf-8&quot;, null); // elimizde bulunan bir html dökümanı webview e basıyoruz. URL de verebilirsin istersen
webView.addJavascriptInterface(new MyWebViewJavascriptInterface(mContext, webView, callbackDialog), &quot;Android&quot;);
</code></pre>

<p>Yukarıda ki “Android” kısmına istediğimiz ismi verebiliriz. WebView yapısı, burada belirtmiş olduğumuz isim ile sayfaya yüklenen içeriğe bir eklenti yapıyor, yani bir instance alıyor. Biz bu instance ı kullanarak iletişimimizi sağlıyoruz.</p>

<p>Az sabır. Nasıl olduğunu görüceksin..</p>

<h2 id="mywebviewclient">MyWebViewClient</h2>

<pre><code class="language-java">class MyWebViewClient extends WebViewClient {

    @Override
    public void onPageFinished(WebView view, String url) {
        super.onPageFinished(view, url);
        //view.loadUrl(&quot;javascript:window.Android.processHTML('&lt;html&gt;'+document.getElementsByTagName('html')[0].innerHTML+'&lt;/html&gt;');&quot;);
    }
}
</code></pre>

<p>Bu blok ne yapıyor ?</p>

<p><strong>window.Android.processHTML</strong> de ki Android bizim yukarıda belirtmiş olduğumuz aracı.</p>

<p><strong>processHtml</strong> ise aşağıda tanımlıcak olduğumuz fonksiyon.</p>

<p>Diğer kısımlar javascript fonksiyonu zaten. Yani sayfada ki ilk html tag ını bularak içindeki html kodu al.</p>

<p>Aşağıda ki processHtml e bakarsan görüceksin ki htmlContent parametresi bekliyor.Biz de bu parametreye sayfa içeriğinin html kodunu gönderiyoruz. Almış olduğun bu html içeriğiyle ne yaparsın sana kalmış.</p>

<h2 id="mywebviewjavascriptinterface">MyWebViewJavascriptInterface</h2>

<pre><code class="language-java">class MyWebViewJavascriptInterface {

    Context mContext;
    WebView mWebView;

    MyWebViewJavascriptInterface(Context c, WebView webView) {
        this.mContext = c;
        this.mWebView = webView;
    }

    @JavascriptInterface
    public void processHTML(String htmlContent) {
        // işlem
        // Toast ile html içeriğini gösterebiliriz       
    }

    @JavascriptInterface
    public void islemeDevamEt() {
       // işlem
    }

    @JavascriptInterface
    public void pencereyiKapat() {
        // işlem
        // dialog.dismiss();
    }
}
</code></pre>

<p>WebView miz ile Android native kodumuzun iletişimini bu sınıf sağlıyor.</p>

<p>Aşşağıda ki  kod ile bunu söylüyoruz.</p>

<p><strong><em>webView.addJavascriptInterface(new MyWebViewJavascriptInterface(mContext, webView), &ldquo;Android&rdquo;);</em></strong></p>

<p><strong><em>Not</em></strong> : Android 4.2 den sonra <strong>@JavascriptInterface</strong> annotations ını eklememiz gerekmekte. Yoksa nolur ? Çalışmaz 😉</p>

<h2 id="custom-html-content">Custom Html Content</h2>

<p>WebView de gösterdiğimiz html contentinde bir buton ekleyelim.</p>

<pre><code class="language-html"> &lt;button class=&quot;btn btn-danger&quot; onclick=&quot;PencereyiKapat()&quot;&gt;Pencereyi Kapat&lt;/button&gt;
</code></pre>

<p>WebView içinde ki bu butona basıldığını Android anlasın ve (WebView imizi Dialog içerisinde gösterildiğini varsayarak) dialog penceresini kapasın.</p>

<p>Butonumuzun olduğu sayfaya  javascript kodumuzu ekliyoruz.</p>

<pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot;&gt;
  function PencereyiKapat() {
     Android.pencereyiKapat();
  }
&lt;/script&gt;
</code></pre>

<p>Yukarıda ki Android i hatırladınız dimi ? 🙂</p>

<p>HTML sayfamız bu kadar.</p>

<p>WebView içerisinde ki butona basıldığında javascript fonksiyonu çalışacak ve Android.pencereyiKapat() çalışacak. Yani native tarafta tanımlamış olduğumuz pencereyiKapat() fonksiyonu.</p>

<p>Yukarıda ki yapıyı kullanarak WebView – Android Native etkileşimli yapı kurabilirsin.</p>

<p>Her zaman ki gibi hayal gücüne ve projeye kalmış 😉</p>

<p>Kalın sağlıcakla..</p>

    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title"></span>
    <span class="item-content">Aykut Asil</span>
  </p>
  <p class="copyright-item">
    <span class="item-title"></span>
    <span class="item-content">2017-01-11</span>
  </p>
  
  
</div>

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="http://yazilim.aykutasil.com/tags/sofware/">sofware</a>
          
          <a href="http://yazilim.aykutasil.com/tags/android/">android</a>
          
          <a href="http://yazilim.aykutasil.com/tags/java/">java</a>
          
          <a href="http://yazilim.aykutasil.com/tags/webview/">webview</a>
          
          <a href="http://yazilim.aykutasil.com/tags/addjavascriptinterface/">addJavascriptInterface</a>
          
          <a href="http://yazilim.aykutasil.com/tags/webviewclient/">WebViewClient</a>
          
          <a href="http://yazilim.aykutasil.com/tags/javascriptinterface/">JavascriptInterface</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="http://yazilim.aykutasil.com/post/csharp_soruisareti_operator/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">CSharp Null Kontrolü</span>
            <span class="prev-text nav-mobile"></span>
          </a>
        
          <a class="next" href="http://yazilim.aykutasil.com/post/docker_komutlari/">
            <span class="next-text nav-default">Docker Komutları</span>
            <span class="prev-text nav-mobile"></span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'yazilimaykutasil';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:aykuttasil@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="http://stackoverflow.com/users/3448461/aykuttasil" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://twitter.com/aykuttasil" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.facebook.com/aykuttasil" class="iconfont icon-facebook" title="facebook"></a>
      <a href="https://www.linkedin.com/in/aykuttasil/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://plus.google.com/&#43;AykutAsil" class="iconfont icon-google" title="google"></a>
      <a href="https://www.github.com/aykuttasil" class="iconfont icon-github" title="github"></a>
      <a href="https://www.instagram.com/aykuttasil/" class="iconfont icon-instagram" title="instagram"></a>
  <a href="http://yazilim.aykutasil.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  

  

  <span class="copyright-year">
    &copy; 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Aykut Asil</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="http://yazilim.aykutasil.com/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="http://yazilim.aykutasil.com/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="http://yazilim.aykutasil.com/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="http://yazilim.aykutasil.com/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>
<script type="text/javascript" src="http://yazilim.aykutasil.com/dist/even.min.js?v=3.1.1"></script>


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-42457939-6', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>







</body>
</html>
